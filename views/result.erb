<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
        <style type="text/css">
        body{
            background-color: #444;
        }
        *{  
            font-family: Verdana;
            margin: 0;
            padding: 0;
            list-style:none;
        }
        .wrap{
            width: 1300px;
            margin: 30px auto;
            color: #ccc;
            padding: 20px;
            border: 1px solid #eee;
        }
        .wrap .size{
            margin-bottom: 20px;
            text-align: right;
        }
        .row {
            display: flex;
            line-height: 30px;
            padding: 5px;
        }
        .row a{
            width: 100%;
            line-height: 30px;
            display: flex;
            padding: 5px;
            text-decoration: none;
            color: #eee;
            border-radius: 5px;
            transition: .3s;
        }
        .head:hover{
            background-color: #eee;
            color: #111;
        }
        .box{
            margin: 0 10px 0;
            border-radius: 5px;
            padding: 0px 5px;
        }
        .row a:hover{
            background-color: #eee;
            color: #111;
        }
        .box.index{
            width: 25px;
            text-align: right;
            padding: 0 10px 0px 0;
        }
        .box.shop{
            width: 180px;
        }
        .box.name{
            display: inline-block;
            width: 800px;
        }
        .box.price{
            width: 55px;
        }
    </style>
</head>

<body>
    <div class="wrap">
    <%= Time.now%>
    <h1>Result</h1>
    <p class="size">共 <%= @ary.size%> 筆資料 / 僅顯示前20頁查詢結果</p>
    <div class="table"">
        <div class="row thead">
                <div class="box head index">
                    No
                </div>
                <div class="box head shop">
                    來源
                </div>
                <div class="box head name">
                    商品名稱
                </div>
                <div class="box head price">
                    售價
                </div>
                <div class="box head price">
                    原價
                </div>
                <div class="box head price">
                    折數
                </div>
        </div>

        <div class="tbody">
            <% @ary.each.with_index do |elem, i|%>
            <div class="row">
                <a href="<%= elem[1][:url] %>" target="_blank">
                <div class="box index">
                    <%= i + 1 %>
                </div>
                <div class="box shop">
                    <%= elem[1][:from_shop]%>
                </div>
                <div class="box name">
                    <%= elem[1][:item_name]%>
                </div>
                <div class="box price">
                    <%= elem[1][:now_price] %>
                </div>
                <div class="box price">
                    <%= elem[1][:ori_price] %>
                </div>
                <div class="box price">
                    <%= if elem[1][:ori_price] != nil
                            "#{(elem[1][:now_price].to_f / elem[1][:ori_price]).round(2)}"
                        end %> 
                </div>
                </a>
            </div>
            <% end %>
        </div>
    </div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" ></script>
    <script type="text/javascript">
    $(document).ready(function() {
        $(document).on('click', '.head', function() {
            let table = $(this).parents('.table').eq(0);
            var rows = table.find('.tbody .row:gt(0)').toArray().sort(comparer($(this).index()));
            this.asc = !this.asc;
            if (!this.asc) { rows = rows.reverse(); }
            table.children('.tbody').empty().html(rows)
        });
        function comparer(index) {
            return function(a, b) {
                var valA = getCellValue(a, index),
                    valB = getCellValue(b, index);
                    console.log(valA)
                    return valA.localeCompare(valB)
                // return $.isNumeric(valA) && $.isNumeric(valB) ?
                //     valA - valB : valA.localeCompare(valB);
            };
        }
        function getCellValue(row, index) {
            console.log($(row).find(`.box:eq(${index})`).text());
            return $(row).find(`.box:eq(${index})`).text()
        }
    })
    </script>
</body>
</html>




